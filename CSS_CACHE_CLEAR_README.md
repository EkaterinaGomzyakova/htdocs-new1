# Сброс кеширования стилей в Bitrix

Этот набор скриптов поможет вам сбросить кеширование CSS стилей в вашем проекте Bitrix с шаблоном aspro.next.

## Доступные скрипты

### 1. `clear_css_cache.php` - Полная очистка (веб-интерфейс)
**Использование:** Откройте в браузере `http://ваш-сайт/clear_css_cache.php`

**Что делает:**
- Очищает основной кеш Bitrix
- Очищает кеш HTML страниц
- Очищает кеш модуля aspro.next
- Удаляет скомпилированные CSS файлы тем
- Удаляет скомпилированные CSS файлы фоновых цветов
- Очищает кеш компонентов и инфоблоков
- Перегенерирует темы
- Устанавливает заголовки для очистки кеша браузера

### 2. `clear_css_cache_cli.php` - Полная очистка (командная строка)
**Использование:** `php clear_css_cache_cli.php`

**Что делает:** То же самое, что и веб-версия, но через командную строку.

### 3. `quick_clear_css.php` - Быстрая очистка (веб-интерфейс)
**Использование:** Откройте в браузере `http://ваш-сайт/quick_clear_css.php`

**Что делает:**
- Очищает основной кеш
- Удаляет только CSS файлы
- Перегенерирует темы

## Ручная очистка

Если скрипты не работают, вы можете выполнить очистку вручную:

### 1. Через админ-панель Bitrix
1. Зайдите в админ-панель
2. Перейдите в "Настройки" → "Производительность" → "Кеширование"
3. Нажмите "Очистить весь кеш"

### 2. Удаление файлов вручную
Удалите следующие директории и файлы:

```bash
# CSS файлы тем
rm -rf /local/templates/aspro_next_custom/themes/*/theme.css
rm -rf /local/templates/aspro_next_custom/themes/*/theme.min.css

# CSS файлы фоновых цветов
rm -rf /local/templates/aspro_next_custom/bg_color/*/bgcolors.css
rm -rf /local/templates/aspro_next_custom/bg_color/*/bgcolors.min.css

# Кеш Bitrix
rm -rf /bitrix/cache/*
rm -rf /bitrix/managed_cache/*
rm -rf /bitrix/stack_cache/*
```

### 3. Через PHP код
Добавьте в любой PHP файл и выполните:

```php
<?php
require($_SERVER["DOCUMENT_ROOT"]."/bitrix/modules/main/include/prolog_before.php");

// Очистка кеша
bx_accelerator_reset();
CHTMLPagesCache::ClearAll();

// Перегенерация тем
if (CModule::IncludeModule('aspro.next') && class_exists('CNext')) {
    CNext::SetOption('NeedGenerateAllThemes', 'Y');
    CNext::GenerateThemes(SITE_ID);
}

echo "Кеш очищен!";
?>
```

## Что происходит при очистке

1. **Основной кеш Bitrix** - очищается системный кеш
2. **HTML кеш** - очищается кеш сгенерированных страниц
3. **CSS файлы тем** - удаляются скомпилированные стили цветовых схем
4. **CSS файлы фонов** - удаляются скомпилированные стили фоновых цветов
5. **Перегенерация** - темы пересоздаются заново на основе LESS файлов

## После очистки

1. Обновите страницу в браузере (Ctrl+F5)
2. Очистите кеш браузера
3. Проверьте, что стили загружаются корректно
4. Если проблемы остаются, проверьте права доступа к файлам

## Устранение проблем

### Ошибка "Необходимы права администратора"
- Убедитесь, что вы залогинены как администратор
- Проверьте, что пользователь имеет права на выполнение PHP скриптов

### CSS файлы не пересоздаются
- Проверьте права на запись в директории `/local/templates/aspro_next_custom/`
- Убедитесь, что модуль `aspro.next` установлен и активен
- Проверьте наличие LESS файлов в модуле

### Стили не применяются
- Очистите кеш браузера
- Проверьте, что CSS файлы загружаются в правильном порядке
- Убедитесь, что нет конфликтов с другими стилями

## Безопасность

⚠️ **Внимание:** Эти скрипты удаляют файлы кеша. Убедитесь, что у вас есть резервная копия перед выполнением.

После использования рекомендуется удалить эти скрипты с сервера для безопасности.
